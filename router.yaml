# The runtime container comes with sensible defaults that work well for most use cases.
# Uncomment the COPY and CMD lines in the Dockerfile to use this configuration.

sandbox:
  enabled: false
supergraph:
  introspection: true
  listen: 0.0.0.0:${env.PORT:-4000}
  query_planning:
    cache:
      in_memory:
        limit: 512 # This is the default value
homepage:
  enabled: false
include_subgraph_errors:
  all: true

cors:
  policies:
    - origins:
        - https://studio.apollographql.com # Apollo Studio Explorer
        - https://app.ticketfi.ai
        - https://app.ticketfi.net
        - https://app.ticketfi.dev
        - https://app.ticketfi.local
      allow_credentials: true
      allow_headers:
        - content-type
        - authorization
        - apollo-require-preflight
      expose_headers:
        - apollo-require-preflight # Required for Apollo Studio

# Header forwarding - CRITICAL for auth to work
headers:
  all:
    request:
      - propagate:
          named: "authorization"
      - propagate:
          named: "cookie"

limits:
  parser_max_tokens: 15000 # This is the default value.
  parser_max_recursion: 4096 # This is the default value.
  max_depth: 100 # Must be 15 or larger to support standard introspection query
  max_height: 200
  max_aliases: 30
  max_root_fields: 20

# Health check
health_check:
  enabled: true

# Telemetry
telemetry:
  apollo:
    endpoint: https://usage-reporting.api.apollographql.com/api/ingress/traces
  instrumentation:
    spans:
      mode: spec_compliant
